import requests
#from requests.auth import HTTPBasicAuth
import json
import sys

url = sys.argv[1]
response = requests.get(url)

# For if the website is held on a private server
#response = requests.get(url, auth = (username, password))
	


headers = response.headers


##Opens up the json file and reads it in as k
with open('ssl.json', 'r') as k:
	#set the json file to ssl
	ssl = json.load(k)

##checks the protocol of the "response"
if url.startswith("http://"):
	protocol = ssl['http']
elif url.startswith("https://"):
	protocol = ssl['https']
else:
	print("invalid url input")
	exit()

print("Thank you for selecting CobraKai as your website vulnerability scanner!\n")
#Prints out the informatsion from the ssl json file
print("Here is some useful information regarding " + url + ":")
print(f"Protocol: {protocol['header']}")
print(f"Description: {protocol['description']}")
print("Advantages:")
print("\n".join([f"- {advantage}" for advantage in protocol['advantages']]))
print("Disadvantages:")
print("\n".join([f"- {disadvantage}" for disadvantage in protocol['disadvantages']]))


#open/read json file
with open('owasp.json','r') as f: 
	owasp = json.load(f)
	
#set open list to keep count
secHeaders = []

#search for headers in json file
for header in owasp["headers"]:
	if header["header"] in headers: 
		print("\n"f"Security header found: '{header['header']}' Description: {header['description']}'")
		secHeaders.append(header)
		

#checks the amount of secuirty headers in the json file while also reading the url
if len(secHeaders) >= 8:
	print("\n""This site has high security")
	print("\n""GRADE : A")
			
elif (len(secHeaders) >= 4) and (len(secHeaders)<=7):
	print("\n""This site has medium security")
	print("\n""GRADE : B")

elif (len(secHeaders) <= 3) and (len(secHeaders) > 0):
	print("\n""This site has low security")
	print("\n""GRADE : C")
	
else:
	print("\n""This site has no security")
	print("\n""Grade : F")